<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cancionero 2025</title>
  <style>
    :root { --bg:#0f1115; --card:#171923; --muted:#a0aec0; --text:#e2e8f0; --accent:#38bdf8; --accent-2:#22c55e; --border:#2d3250; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .wrap { max-width:1100px; margin:24px auto; padding:16px; }
    .header { display:grid; grid-template-columns:1fr; gap:12px; margin-bottom:16px; }
    .title { font-size:clamp(22px,2.8vw,32px); font-weight:800; display:flex; align-items:center; gap:10px; }
    .pill { font-size:12px; color:var(--bg); background:linear-gradient(135deg, var(--accent), var(--accent-2)); padding:4px 10px; border-radius:999px; font-weight:700; }
    .toolbar { display:grid; grid-template-columns:1fr; gap:10px; }
    @media (min-width: 720px) { .toolbar { grid-template-columns: 1fr 220px 220px; } }
    .search, select { width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#0b0d13; color:var(--text); outline:none; transition:border-color .2s ease, box-shadow .2s ease; }
    .search:focus, select:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(56,189,248,.2); }
    .meta { margin:6px 2px 14px; color:var(--muted); font-size:13px; }
    .grid { display:grid; grid-template-columns:1fr; gap:10px; }
    @media (min-width:680px){ .grid { grid-template-columns:1fr 1fr; } }
    @media (min-width:980px){ .grid { grid-template-columns:1fr 1fr 1fr; } }
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px; display:grid; gap:8px; transition:transform .12s ease, border-color .12s ease; }
    .card:hover { transform:translateY(-1px); border-color:#3b3f5c; }
    .topline { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .song-title { font-weight:700; font-size:16px; line-height:1.3; }
    .code { font-weight:800; font-variant-numeric:tabular-nums; background:#0b0d13; border:1px solid var(--border); padding:4px 8px; border-radius:10px; color:#a5f3fc; }
    .muted { color:var(--muted); font-size:13px; }
    .actions { display:flex; flex-wrap:wrap; align-items:center; gap:8px; }
    .btn { font-size:13px; padding:6px 10px; border-radius:10px; text-decoration:none; color:var(--text); border:1px solid var(--border); background:#0b0d13; transition:background .12s ease, border-color .12s ease; }
    .btn:hover { background:#0b0f1b; border-color:#394063; }
    .btn.primary { background:linear-gradient(135deg, #2563eb, #06b6d4); border:none; }
    .no-results { text-align:center; padding:36px 12px; color:var(--muted); border:1px dashed var(--border); border-radius:16px; margin-top:10px; }
    .foot { margin:22px 2px; color:var(--muted); font-size:12px; }
    .hl { background:rgba(56,189,248,.18); padding:0 2px; border-radius:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        Cancionero 2025
        <span class="pill" id="count-pill">0 canciones</span>
      </div>
      <div class="toolbar">
        <input class="search" id="q" placeholder="Buscar por código, título o artista..." aria-label="Buscar">
        <select id="artist"><option value="">Todos los artistas</option></select>
        <select id="sort">
          <option value="code_asc">Orden: Código (0→9)</option>
          <option value="code_desc">Orden: Código (9→0)</option>
          <option value="title_asc">Orden: Título (A→Z)</option>
          <option value="title_desc">Orden: Título (Z→A)</option>
          <option value="artist_asc">Orden: Artista (A→Z)</option>
          <option value="artist_desc">Orden: Artista (Z→A)</option>
        </select>
      </div>
      <div class="meta" id="meta"></div>
    </div>

    <div id="grid" class="grid"></div>
    <div id="empty" class="no-results" style="display:none;">No hay resultados para tu búsqueda.</div>

    <div class="foot">Hecho para <strong>Jimdo</strong> — Inserta este HTML en un bloque de código. Funciona sin dependencias externas.</div>
  </div>

  <!-- Pega aquí tu JSON. Debe incluir "code" (número de piano) por canción. -->
  <script id="cancionero-data" type="application/json">[
    { "code":"101", "title":"Lágrimas de Mármol", "artist":"Joaquín Sabina",
      "lyrics_url":"https://www.google.com/search?q=letra+Lagrimas+de+Marmol+Joaquin+Sabina",
      "tabs_url":"https://acordes.lacuerda.net/joaquin_sabina/lagrimas_de_marmol", "file_url":"" },
    { "code":"102", "title":"Sintiéndolo mucho", "artist":"Joaquín Sabina",
      "lyrics_url":"https://www.google.com/search?q=letra+Sintiendolo+Mucho+Joaquin+Sabina",
      "tabs_url":"https://acordes.lacuerda.net/joaquin_sabina/sintiendolo_mucho", "file_url":"" }
    /* ... resto de tus canciones con "code" ... */
  </script>

  <script>
    // Datos
    const DATA = JSON.parse(document.getElementById('cancionero-data').textContent || '[]');

    // Utilidades
    const stripAccents = s => (s || '').normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    const norm = s => stripAccents(String(s || '')).toLowerCase();

    // UI
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');
    const artistSel = document.getElementById('artist');
    const sortSel = document.getElementById('sort');
    const meta = document.getElementById('meta');
    const countPill = document.getElementById('count-pill');

    // Poblar artistas
    Array.from(new Set(DATA.map(x => x.artist).filter(Boolean)))
      .sort((a,b)=>a.localeCompare(b))
      .forEach(a => {
        const opt = document.createElement('option');
        opt.value = a; opt.textContent = a;
        artistSel.appendChild(opt);
      });

    // Resaltado (escapado para Jimdo)
    function highlight(text, query) {
      if (!query) return text;
      const safe = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&').trim();
      if (!safe) return text;
      try {
        const re = new RegExp('(' + safe.split(/\s+/).join('|') + ')', 'gi');
        return String(text || '').replace(re, m => '<span class="hl">' + m + '<\\/span>');
      } catch { return text; }
    }

    function render() {
      const qv = norm(q.value);
      const av = artistSel.value;
      let arr = DATA.slice();

      // Filtro
      arr = arr.filter(x => {
        if (av && x.artist !== av) return false;
        if (!qv) return true;
        const blob = norm([x.code, x.title, x.artist].join(' '));
        return qv.split(/\s+/).filter(Boolean).every(t => blob.includes(t));
      });

      // Orden
      const s = sortSel.value;
      const cmp = (k, dir=1) => (a,b)=>{
        const va = String(a[k] ?? ''), vb = String(b[k] ?? '');
        if (k === 'code') {
          const na = parseInt(va,10), nb = parseInt(vb,10);
          if (!isNaN(na) && !isNaN(nb)) return (na-nb)*dir;
        }
        return va < vb ? -1*dir : va > vb ? 1*dir : 0;
      };
      if (s === 'code_asc') arr.sort(cmp('code', 1));
      if (s === 'code_desc') arr.sort(cmp('code', -1));
      if (s === 'title_asc') arr.sort(cmp('title', 1));
      if (s === 'title_desc') arr.sort(cmp('title', -1));
      if (s === 'artist_asc') arr.sort(cmp('artist', 1));
      if (s === 'artist_desc') arr.sort(cmp('artist', -1));

      // Pintar
      grid.innerHTML = '';
      const qRaw = q.value.trim();
      arr.forEach(x => {
        const card = document.createElement('div'); card.className = 'card';

        const top = document.createElement('div'); top.className = 'topline';
        const title = document.createElement('div'); title.className = 'song-title';
        title.innerHTML = highlight(x.title || '(Sin título)', qRaw);
        const badge = document.createElement('div'); badge.className = 'code';
        badge.textContent = x.code || '—';

        top.appendChild(title); top.appendChild(badge); card.appendChild(top);

        const sub = document.createElement('div'); sub.className = 'muted';
        sub.innerHTML = (x.artist ? '· ' + highlight(x.artist, qRaw) : '');
        card.appendChild(sub);

        const actions = document.createElement('div'); actions.className = 'actions';
        if (x.lyrics_url) { const a=document.createElement('a'); a.className='btn primary'; a.textContent='Letra'; a.target='_blank'; a.rel='noopener noreferrer'; a.href=x.lyrics_url; actions.appendChild(a); }
        if (x.tabs_url) { const a=document.createElement('a'); a.className='btn'; a.textContent='Tabs/Acordes'; a.target='_blank'; a.rel='noopener noreferrer'; a.href=x.tabs_url; actions.appendChild(a); }
        if (x.file_url) { const a=document.createElement('a'); a.className='btn'; a.textContent='Archivo'; a.target='_blank'; a.rel='noopener noreferrer'; a.href=x.file_url; actions.appendChild(a); }
        if (!x.lyrics_url && !x.tabs_url && !x.file_url) { const s=document.createElement('span'); s.className='muted'; s.textContent='Sin enlaces'; actions.appendChild(s); }

        card.appendChild(actions);
        grid.appendChild(card);
      });

      empty.style.display = arr.length ? 'none' : 'block';
      countPill.textContent = `${arr.length} canciones`;
      meta.textContent = `Mostrando ${arr.length} de ${DATA.length} canciones` + (av ? ` · Artista: “${av}”` : '') + (q.value ? ` · Búsqueda: “${q.value}”` : '');
    }

    q.addEventListener('input', render);
    artistSel.addEventListener('change', render);
    sortSel.addEventListener('change', render);
    render();
  </script>
</body>
</html>
